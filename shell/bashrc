#!/usr/bin/env bash

# Bash Options {{{
#Control history saves
HISTCONTROL=ignoreboth:ignoredups:ignorespace
shopt -s histappend

#Set reverse and forward search for arrow keys
bind '"\e[A"':history-search-backward
bind '"\e[B"':history-search-forward

# Make bash check its window size after a process completes
shopt -s checkwinsize
# }}}

# Helper function {{{

function CHECK_AND_SOURCE() {
  while [[ "$#" -ne 0 ]]; do
    if [[ -r "$1" ]]; then
      source "$1"
    fi
    shift
  done
}

# }}}

# Environment variables
CHECK_AND_SOURCE \
  "$HOME/.config/env.sh" \
  "$HOME/.config/aliases.sh"

# Skip the remaining file for non-interactive shells
if [[ "$-" != *i* ]]; then
  unset CHECK_AND_SOURCE
  return
fi

# Bash Completion {{{

if [[ "${UNAME:=$(uname -s)}" = "Linux" ]]; then
  CHECK_AND_SOURCE \
    "$(shopt -oq posix || echo '/usr/share/bash-completion/bash_completion')" \
    /usr/share/doc/fzf/examples/completion.bash \
    /usr/share/doc/fzf/examples/key-bindings.bash \
    /etc/grc.sh
elif [[ "${UNAME:=$(uname -s)}" = "Darwin" ]]; then
  CHECK_AND_SOURCE \
    "$(brew --prefix)/etc/profile.d/bash_completion.sh" \
    "$(brew --prefix)/opt/fzf/shell/completion.bash" \
    "$(brew --prefix)/opt/fzf/shell/key-bindings.bash" \
    "$(brew --prefix)/etc/grc.sh" \
    "$HOME/.config/iterm2_shell_integration.bash"
fi

# }}}

# Theme
CHECK_AND_SOURCE \
  "$HOME/.config/bash.prompt.sh" \
  "$HOME/.config/base16-shell/scripts/base16-material.sh"

unset CHECK_AND_SOURCE

# vim:foldmethod=marker
