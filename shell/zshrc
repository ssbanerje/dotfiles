#!/usr/bin/env zsh

# Skip all this for non-interactive shells
[[ -z "$PS1" ]] && return

HISTSIZE=10000
SAVEHIST=10000
setopt AUTOCD
setopt ALWAYS_TO_END COMPLETE_IN_WORD
setopt AUTOPUSHD PUSHDMINUS PUSHDSILENT PUSHDTOHOME PUSHDIGNOREDUPS
setopt CORRECT
setopt COMPLETE_ALIASES COMPLETE_IN_WORD
setopt EXTENDED_GLOB
setopt HIST_EXPIRE_DUPS_FIRST HIST_FIND_NO_DUPS HIST_IGNORE_ALL_DUPS HIST_REDUCE_BLANKS SHARE_HISTORY
setopt LOCAL_OPTIONS LOCAL_TRAPS

# Enable Powerlevel10k instant prompt.
# if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  # source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
# fi
if [[ -f "$HOME/.p10k.zsh" ]]; then
  source "$HOME/.p10k.zsh"
fi

# Load antigen
export POWERLEVEL9K_DISABLE_CONFIGURATION_WIZARD=true
source "$HOME/.config/antigen.zsh"
antigen init "$HOME/.config/antigenrc"

# Make fancy-ctrl-z work with zvm
zvm_define_widget fancy-ctrl-z fancy-ctrl-z
zvm_bindkey viins '^Z' fancy-ctrl-z

# Setup completions
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'
zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#) ([0-9a-z-]#)*=01;34=0=01'
zstyle ':completion:*:*:*:*:processes' command "ps -u $(whoami) -o pid,user,comm -w -w"
zstyle ':completion:*:ssh:*' tag-order hosts users
zstyle ':completion:*:ssh:*' group-order hosts-domain hosts-host users hosts-ipaddr
zstyle ':completion:*:functions' ignored-patterns '_*'
zstyle ':completion:*:*:kill:*' menu yes select

# Source stuff
zsh-defer source "$HOME/.config/zshrc.$(uname -s).sh"
zsh-defer source "$HOME/.config/env.sh"

# Setup color scheme
BASE16_SHELL=$HOME/.config/base16-shell/
if [[ "$-" == *i* && -f $BASE16_SHELL/scripts/base16-material.sh ]]; then
  zsh-defer -1 source ${BASE16_SHELL}/scripts/base16-material.sh
fi
unset BASE16_SHELL
